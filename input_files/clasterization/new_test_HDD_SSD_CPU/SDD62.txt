
Изучаем и сравниваем Thunderbolt 3 в качестве интерфейса для внешнего SSD на примере Wavlink ThunderDrive II
Оглавление

    Wavlink ThunderDrive II
    Тестирование
    Методика тестирования
    Производительность в приложениях
    Последовательные операции
    Работа с большими файлами
    Итого

Методика тестирования накопителей образца 2018 года

Когда пять лет назад на рынок выходил USB 3.1, для демонстрации всех возможностей нового интерфейса производителям пришлось разрабатывать специальные накопители, в которых два SATA SSD объединялись в массив RAID0. Иначе преимущества не вытанцовывались — сам по себе SATA600 (на тот момент практически безальтернативный — и появившийся еще в конце нулевых) лишь немногим быстрее, чем USB 3.0 (родом из того же конца нулевых). При этом на тот момент даже переделка одиночного SSD во внешнее исполнение была экзотикой (ибо дорого), а бал правили низкоскоростные флэшки или и вовсе ноутбучные винчестеры (которым и древнего SATA300 хватало с большим запасом), так что новый интерфейс воспринимался лишь как задел на будущее — которое когда-нибудь точно наступит, но вряд ли завтра.

Действительность оказалась куда более суровой: как раз в то же время началась экспансия твердотельных накопителей с интерфейсом PCIe, да еще и стоимость флэш-памяти начала снижаться. В итоге мгновенно оказалось, что USB 3.1 (в полном исполнении, разумеется, т. е. Gen2 — а не переименованный в Gen1 старичок USB 3.0) — решение уже не перспективное, а... недостаточное. Пропускная способность в 10 Гбит/с немногим выше, чем можно получить от одной линии PCIe 3.0 — но намного ниже, чем PCIe 3.0 x2, становящийся атрибутом бюджетных SSD. Выжать больше из одного линка USB не получалось, и лучшее, что смогли придумать разработчики в следующей версии спецификаций — агрегирование двух линий в разъеме с удвоением пропускной способности (USB 3.2 Gen2×2), но это требовало новых контроллеров, новых разъемов, новых (более толстых хотя бы) кабелей и не решало проблему принципиально. Действительно: обогнать PCIe 3.0 x2 получится, а вот догнать х4 — нет. Учитывая, что и второе-то начинает встречаться даже в недорогих накопителях, да еще и внедрение PCIe 4.0 на горизонте забрезжило раньше, чем были приняты окончательные спецификации USB 3.2, очевидно, что это тупик.

Нельзя сказать, что разработчики о нем не знали — более того, знали и готовились. Недаром же большинство работающих над USB компаний параллельно отметились и в качестве создателей Thunderbolt, пропускная способность которого обычно соответствует как раз четырем линиям PCIe и растет вслед за этим стандартом. Таким образом, для реализации скоростных возможностей PCIe 3.0 x4 достаточно Thunderbolt 3 образца 2015 года. На деле же для подключения накопителей применялись и предыдущие версии стандарта, но особых следов на рынке эти решения не оставили, поскольку не было «правильных» (таких, которым это может пригодиться) накопителей. Теперь — появились. Но речь о полном отказе от USB в пользу Thunderbolt все-таки не идет — и идти не может. Несмотря на то, что ТВ3 стал составляющей USB 4.0, а унификация разъемов и кабелей началась еще с 2015 года, это совершенно отдельные режимы работы, по умолчанию без какой-либо совместимости. USB-накопитель можно подключать даже к компьютеру 20-летней давности, ТВ — только к снабженному контроллером ТВ (или USB 4.0). Реализовать совместимость в принципе можно, но пока это сделано лишь в контроллерах линейки Intel Titan Ridge, да и то периферия на базе JHL7440 при подключении к USB-порту будет обеспечивать лишь ограниченную функциональность. А хуже всего то, что контроллеры-то анонсированы два года назад — а продуктов на них еще не видать.
Обзор внешнего SSD Samsung X5 с интерфейсом Thunderbolt 3

В общем, накопители с интерфейсом Thunderbolt 3 — решения нишевые и (до последнего времени) очень дорогие. В частности, год назад мы тестировали внешний SSD Samsung X5. Отличный, быстрый накопитель, но с ценой от 30 тысяч рублей за модификацию на 1 ТБ (а год назад были все 50 тысяч). И даже неважно, что внешний винчестер той же емкости стоит в десять раз дешевле, потому что в ассортименте той же компании есть и менее пафосный внешний SSD T5 примерно за 13 тысяч рублей (в среднем по Москве на момент написания статьи). Да, существенно более медленный, зато универсальный и недорогой. А если есть сильное желание сэкономить, то можно и самому собрать готовое устройство — причем если не слишком экономить, то даже более быстрое, чем Т5. Для этого давно уже есть коробочки на контроллерах ASMedia ASM2362 и JMicron JMS583, позволяющих подключать NVMe-накопители к порту USB 3.1 Gen2.

Так бы оно, возможно, и тянулось — но принятие спецификаций USB 4.0 рынок встряхнуло. Производители зашевелились, причем в сторону «второго» поколения контроллеров, т. е. Titan Ridge. Запасы же «оригинального» Alpine Ridge начали распродаваться на открытом рынке, что позволило начать выпускать соответствующие продукты мелким производителям. В принципе, на AliExpress и год назад можно было купить соответствующую коробочку для SSD, но цены начинались от $200, к чему нужно было добавить еще и сам SSD. Сейчас же они немножко обвалились, так что масса продавцов предлагает таковые примерно за $85. Тоже не так уж дешево, конечно, но все-таки не $200. А нам давно хотелось «погонять» один и тот же твердотельный накопитель на разных интерфейсах (для более полного раскрытия темы), так что снижение цен заставило действовать.
Wavlink ThunderDrive II

В принципе, все такие устройства работают одинаково, благо поголовно используют контроллер Intel JHL6540. Да и цены примерно одинаковые. Так что выбрана была самая красивая коробочка с самой богатой комплектацией, за что (с учетом купонов и скидок) пришлось заплатить примерно $75, подождать неделю (пока посылка добиралась из Китая до ближайшей «Пятерочки»), и...

К такому меня жизнь не готовила. Продавца, по-видимому, тоже — почему на коробке и появилась постфактум наклейка с информацией, которой не было в описании товара. Зато заодно был получен практический опыт общения с низкопрофильными слотами M.2 — как оказалось, «впихнуть» в них можно любые SSD, и работать они будут. Но элементы на оборотной стороне «упрутся» в основную плату, сам накопитель будет стоять под углом к ней, зафиксировать его болтиком не удастся — в общем, для практического использования не подойдет. Для тестирования же — без проблем.

Что касается комплекта, то тут на него не скупились.

Кабель тоже интересный: его можно прикрутить к корпусу устройства.

Также есть транспортировочный мешочек и универсальная мини-отвертка.

И радиатор для самого SSD. В принципе, большой необходимости в нем не обнаружилось, но «сильно горячие» накопители мы и не использовали. Охлаждение в любом случае пассивное, так что основная задача радиатора — перераспределять тепло по площади устройства. В частности, «подогревая» микросхемы флэш-памяти, что (теоретически) им даже полезно при записи данных.

Сама платка простая, благо основную работу выполняет один компактный контроллер Intel JHL6540, прячущийся на ее оборотной стороне. Трудно поверить, но этот квадратик со стороной 10,7 мм способен каждую секунду прокачивать через себя гигабайты данных. Во всяком случае, в теории — соответствие которой практике и надо бы проверить.
Тестирование
Методика тестирования

Методика подробно описана в отдельной статье. Там можно познакомиться с используемым программным обеспечением, а вот в качестве тестового стенда мы в очередной раз использовали NUC 7i7BNH, на который плавно «переместились» в процессе изучения внешних SSD.
Обзор двух USB-коробочек для NVMe-накопителей на чипах ASMedia ASM2362 и JMicron JMS583

Впрочем, то, что в наши руки попала именно коробочка, прямо-таки располагало взять внутренний накопитель — и протестировать его и внутри NUC, и в главной героине, и в более простой и дешевой USB-модели на ASMedia ASM2362. В качестве такового мы решили использовать Gigabyte Aorus NVMe Gen4 SSD 2 ТБ: это модель с интерфейсом PCIe 4.0 x4, так что для того, чтобы хоть как-то воспользоваться «подросшими» возможностями новой версии стандарта, производителю пришлось попотеть — в итоге пропускную способность PCIe 3.0 x4 она выбирает полностью и при записи, и при чтении. Правда, постоянная эксплуатация этого SSD в ThunderDrive II невозможна из-за двухстороннего дизайна, но прогнать тесты это не помешало. В том числе, и при закрытой крышке, но без установки комплектного радиатора (его применение тоже невозможно — по той же причине) — перегреть накопитель нам не удалось даже синтетикой. В общем, современные твердотельные накопители греются намного меньше, чем устройства первой волны. Что тоже располагает к экспериментам именно с ними.

Также для сравнения мы взяли два внешних SSD Samsung — T5 и Х5 по 1 ТБ каждый. Второй нам интересен поскольку это тоже устройство с интерфейсом Thunderbolt 3, первый — как пример массового сегмента внешних SSD на базе SATA-накопителя внутри.

В сегодняшнем тестировании для всех испытуемых использовалась файловая система NTFS. Кэширование записи для USB-накопителей включено (у TB3 этой проблемы нет — там оно по умолчанию включено сразу). Отметим, что с командой TRIM проблем нет ни у одного из устройств — при использовании NTFS, разумеется (для томов exFAT в Windows эта функциональность не реализована).
Производительность в приложениях

Долгое время для внешних накопителей этот вопрос был не слишком важен — нормально работали лишь специализированные portable-версии ПО, ну и установленные на компьютер программы можно было «натравить» на внешнее хранилище также, как на внутреннее — да и все. Однако больше 10 лет назад в Microsoft серьезным образом озаботились темой, так что на данный момент Windows и весь софт можно установить даже на USB-флэшку. В общем, главным вопросом является просто обеспечение загрузки — с которым в данном случае все оказалось очень просто: нам даже не пришлось каким-то специальным образом готовить систему. Просто установили в коробочку SSD с установленной Windows 10, включили загрузку с Thunderbolt и... Дальше никакой разницы между внутренним слотом M.2 и внешним портом не наблюдалось. Что, понятно, дает еще один потенциальный плюс в копилку достоинств Thunderbolt: не обязательно устанавливать накопитель в компьютер, да и последний вовсе можно использовать просто как док-станцию для обеспечения многопользовательского рабочего места (каждый приходит со своим внешним SSD и, поработав, уносит все с собой) без каких-либо ограничений производительности. Или почти без них — для точного ответа на вопрос нам, как обычно, потребуются тестовые утилиты.

Впрочем, как уже не раз было сказано, «системная» производительность разных SSD примерно одинаковая и от интерфейса подключения не зависит. По очень простой причине: скорость дисковых операций в исполнении «механики» узким местом оказаться может, а флэш-памяти уже достаточно, чтобы общую производительность компьютера всегда ограничивали другие компоненты и/или сам пользователь. Но небольшой разброс есть, он всегда в пользу NVMe, а потери на преобразования среды передачи данных не превышают 0,3 процентов. С другой стороны, и радикальное преобразование в USB не так уж страшно — чуть более 1,5% потерь.

На деле могло бы быть и больше, если бы программам реально требовалось больше. Если убрать задержки с их стороны, то потенциально получаем не проценты, а разы. USB-коробочка для NVMe-накопителя режет его скорость почти вдвое — но это все равно радикально быстрее, чем более дешевая (и привычная) схема USB—SATA. Да и не USB — тоже: от некоторых SATA-накопителей внутри компьютера мы подобные результаты получали, но очень-очень редко). А потери на работу Thunderbolt немногим превышают 10% — чем уже можно и пренебречь: реальных конкурентов-то нет.
Последовательные операции

Но наиболее показательны, естественно, такие нагрузки — в первую очередь зависящие от интерфейса. Для взятого нами SSD это верно и при записи данных — он рассчитан, все-таки, на PCIe 4.0, так что предыдущую версию стандарта утилизирует полностью. А с чтением проблем нет и у многих недорогих моделей. И тут стоит отметить, что преобразование интерфейсов производительность режет — недаром, например, при чтении результаты оказались практически идентичны Samsung X5, но это заметно меньше, чем «может» сам накопитель внутри компьютера. Но и в три раза больше, чем способности USB 3.1 Gen2. Соответственно, даже если кто-то сделает коробочку под USB 3.2 Gen2×2, то и это в полтора раза отстанет от Thunderbolt 3. Даже силами уже не новых контроллеров — в следующем поколении пропускная способность интерфейса, возможно, что и немного увеличена. Хотя это не так уж и важно — не уступающей альтернативы все равно нет.
Работа с большими файлами

Повторяется расклад низкоуровневых утилит — только вот скорость однопоточного режима CDM явно меряет не совсем корректно, но с данной программой это бывает. При использовании же PCIe «в чистом виде» программа, напротив, проявляла излишний оптимизм — так что от перехода на файловый уровень выиграли в какой-то степени обе коробочки. Но сами по себе они работают очень по-разному — USB 3.1 Gen2 заметно ограничивает скорость топовых SSD в любом случае, а Thunderbolt 3 иногда даже этого не делает. Если и делает, то на каких-то 15%, а не в разы. Сравнение же с массовыми внешними SSD (на базе SATA-устройств) становится и вовсе бессмысленным: до пяти раз — это уже принципиальное отличие.

При записи NASPT тоже более благосклонен к внешним интерфейсам, нежели CDM. Но важнейшим для нас сегодня является то, что ведут они себя по-разному — что было понятно и априори, но проверка никогда не лишняя. Причем и удвоения скорости USB 3.x при работе двух линков (что как раз и было предложено в рамках Gen2×2) недостаточно для паритета даже с версией Thunderbolt пятилетней давности. Но там-то ресурсы масштабирования еще есть — нужно просто перейти на PCIe 4.0 «внутри», что в перспективе и запланировано.

Запись одновременно с чтением положение дел не меняет. Thunderbolt — самый быстрый из пригодных для внешних накопителей интерфейс, существующий на практике. Некоторые модели SSD он, конечно, ограничивает, однако основной массе до такого уровня самой еще нужно дорасти. А востребовано такое или нет — каждому придется решать самостоятельно.
Итого

Что Thunderbolt — интерфейс быстрый, мы знали и раньше. Проблема в том, что до последнего времени его реализация обходилась слишком дорого, а накопителей, способных воспользоваться такими возможностями, практически не было. Теперь же таковые появились, а цены заметно снизились. Пусть устройства все равно бюджетными не стали — все-таки за цену одной такой коробочки можно даже целый внешний SSD купить как минимум на 500 ГБ (если же не гоняться за брендами, то и на 1 ТБ). Или зайдем с другой стороны — корпуса на каком-нибудь ASM2362 стоят в пять-шесть раз дешевле, а свой гигабайт в секунду выдавать способны. Если нужно больше, так еще и внутрь придется ставить небюджетный SSD. В общем, стоимость решения получается, конечно, куда более низкой, чем с год назад — но все равно высокой. Да еще и проблема совместимости в этом поколении устройств никуда не делась: USB-накопитель можно подключать куда угодно (хоть к телефону, хоть к телевизору, хоть к компьютеру десятилетней давности), а поддержка Thunderbolt требуется в явном виде (хотя бы первых двух версий — но в этом случае придется обзавестись еще и переходником, а скорость будет в два-четыре раза ниже). Понятно, что внедрение USB 4.0 (составной частью которого стал Thunderbolt) положение дел несколько изменит — но, в любом случае, коснется это лишь новейших компьютерных систем, не затрагивая широкие массы трудящихся с разнообразной техникой на руках. Обновление же ассортимента накопителей начнется как обычно в топовом сегменте — и за «двухстандартность» JHL7440 наверняка придется доплачивать. Сколько — пока не известно, поскольку сами они к нам в руки пока не попадались и где купить непонятно. Очень может быть, что и вовсе такие продукты будут поставляться уже под маркой USB 4.0 — с соответствующим ажиотажем в начале продаж.

Поэтому, как и ранее, накопители данного класса по-прежнему невозможно считать массовыми решениями для всех и каждого. Но на такую роль они и не претендуют. Зато с успехом справляются с тем, что от них и ожидалось: максимальная производительность, соответствующая лучшим внутренним SSD (а возможность загрузки и вовсе позволяет обходиться без внутренних, ни в чем себе не отказывая). Разумеется, за это приходится платить. Разумеется, для скоростных рекордов требуется обеспечить соответствующие условия. Но если они обеспечены, платить есть чем и интерес к производительности тоже есть, то... альтернатив на рынке на данный момент нет. В будущем — возможны: если в массы «пойдет» JHL7440 и его аналоги от других производителей, к списку достоинств добавится и универсальность — которой сейчас так не хватает. Но это вопрос будущего. А главное, ради чего этот интерфейс и стоит выбирать, доступно уже сейчас.
