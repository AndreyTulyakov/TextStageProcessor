
Экспресс-тестирование реализаций PCIe на платформе AMD AM4: два процессора, два чипсета, два быстрых SSD с интерфейсами PCIe 3.0 и 4.0
Оглавление

    Х570 и вопросы совместимости
    Тестирование
    Методика и объекты
    Производительность в приложениях
    Последовательные операции
    Случайный доступ
    Работа с большими файлами
    Рейтинги
    Итого

Методика тестирования накопителей образца 2018 года
Экспресс-тестирование разных скоростных режимов PCIe на платформах AMD AM4 и Intel LGA1151 применительно к быстрому SSD

Тестируя первые оказавшиеся в нашей лаборатории SSD с интерфейсом PCIe 4.0, мы упомянули, что на сегодняшний день реализовать такой режим работы можно всего одним способом — используя процессор Ryzen серии 3000 на плате с чипсетом X570. Оба условия являются необходимыми — ни нового процессора на старой плате, ни старого на новой недостаточно. Но как эти связки работают — в общем-то, тоже интересно. Тем более, что некоторое время назад мы провели экспресс-тестирование обеих массовых платформ с точки зрения подключения высокоскоростных SSD, и пришли к выводу, что реализация интерфейса PCIe 3.0 x4 в процессорах Ryzen «2000» по производительности уступает настольным решениям Intel начиная от первой версии LGA1151 образца 2015 года. Не в том плане, что пользоваться невозможно — просто «выжать» получается лишь столько, сколько на ультрабучной платформе, т. е. потенциальные возможности наиболее скоростных накопителей не реализуются в полной мере. Где-то по вине самих контроллеров, где-то, наверняка, сказывалась более низкая «однопоточная» производительность «старых» Ryzen (недаром же паритет с Core i7-7567U все-таки получался) — но вот так. Причем шла об использовании одного накопителя — «не обижая» видеокарту два SSD на полной скорости в составе платформы АМ4 использовать было нельзя. У LGA1151, впрочем, в этом плане тоже не все гладко, поскольку интерфейс между процессором и чипсетом имеет ту же пропускную способность, что и PCIe 3.0 x4, так что в теории два одновременно работающих SSD, подключенных к чипсету, будут тормозить друг друга. На практике этим можно пренебречь, поскольку одновременно и «в одну сторону» им работать не приходится, но такой потенциальный недостаток есть. А на АМ4 — и возможности такой не было.

Сейчас — появилась. И не только она — максимальным скоростным режимом стал PCIe 4.0. Но, когда и что доступно — есть нюансы.
Х570 и вопросы совместимости

Вопросы истории использования PCIe, особенности разных версий и количества линий, а также практических реализаций интерфейса в разных платформах по состоянию на весну этого года в упомянутом материале рассматривались, что называется, ab ovo, так что возвращаться мы к ним сегодня не будем — желающие могут перечитать статью. Сегодня же нас интересует узкий частный вопрос: что летом изменилось в рамках платформы АМ4?

Как уже сказано выше, появились процессоры Ryzen «3000» и чипсет Х570 — и то, и другое поддерживает PCIe 4.0. Процессоры — для связи с видеокартой, чипсетом и все тот же «выделенный» интерфейс х4 для «первичного» SSD — изменилась только версия стандарта, но не общее количество линий. Из 16 линий чипсета четыре используются для связи с процессором, а для подключения различных устройств остается 12 линий PCIe 4.0, которые можно распределять по разным слотам и устройствам. Причем нам кажется, что AMD «неправильно слона продает» — ключевым в Х570 является не то, что там PCIe 4.0, а что (наконец-то!) не 2.0. Действительно — устройств, которым нужно именно 4.0 на рынке практически нет, а вот 3.0 уже водятся. А если еще учесть, что на четвертую версию стандарта перешла и связь между процессором и чипсетом... Значит в новых системах на полной скорости и не мешая друг другу даже в теории могут работать три SSD с интерфейсом PCIe 3.0 x4 — один в «выделенном» слоте (в принципе, и 4.0 тут тоже ни с кем ничего делить не будет) и два подключенных к чипсету. Раньше для такого требовалась HEDT-платформа — теперь же подобное можно получить и в рамках АМ4.

Но только при использовании платы на базе Х570. Таковые всем хороши... кроме цены. И, глядя на цены, многие потенциальные покупатели еще до выхода новых продуктов заявляли, что покупать новые процессоры будут, но предпочтут для них «старые» платы — которые дешевле. К сожалению, в этом случае все остается по-прежнему: чипсеты с поддержкой только PCIe 2.0, а для SSD — один слот PCIe 3.0 x4. И не важно — какой процессор: новые будут работать также, как старые. Просто сами по себе быстрее, конечно, но для периферийных устройств никаких улучшений.

А что будет если купить новую плату под старый процессор? Например, в расчете на последующий апгрейд процессора — если, к примеру, имеющаяся кажется недостаточной для топового Ryzen 9? В этом случае на чипсетных линиях мы получим... PCIe 3.0. Логично, но не так уж и радует. Еще хуже другое — «процессорный» слот у нас четко валился в PCIe 3.0 x2, что уже и не логично, и вовсе плохо. Впрочем, проверили пока всего одну плату, однако звоночек тревожный. Пусть, возможно и надуманный — спешить покупать новую плату особого смысла нет. Тем более, что они дорогие. Да и не все старые процессоры вообще будут поддерживаться — как правило за кадром совершенно официально Bristol Ridge и «1000»-е Ryzen. Возможно, что, если компания выпустит какой-нибудь удешевленный В550, вопросы совместимости плат на нем со старыми процессорами и станут актуальными. А пока же они имеют лишь теоретическое значение. Но имеют — поэтому такой вариант мы тоже протестировали.

Кстати, о тестах...
Тестирование
Методика и объекты

Методика подробно описана в отдельной статье, там же можно познакомиться с используемым программным обеспечением. Аппаратное, естественно, изменилось. Мы взяли два процессора Ryzen 7 — старый топ 2700Х и новый не топ (но более быстрый, хоть и похожий по организации) 3700Х. И устанавливали их на две платы MSI — MEG X570 ACE и X470 Gaming M7 AC (на каких чипсетах — понятно из названия). В первом случае SSD тестировали и в процессорном, и в чипсетном разъемах, во втором — только в процессорном: изучать в очередной раз возможности PCIe 2.0 x4 — лишняя трата времени.

Итого — шесть конфигураций. На самом деле, 12 — накопителя тоже было два: для полноты результатов мы взяли Aorus NVMe Gen4 SSD 2 ТБ с поддержкой PCIe 4.0, и «более народный» WD Black SN750 1 ТБ, рассчитанный на PCIe 3.0 x4. Причина проста — пока еще таковые куда более актуальны. Да и вообще могут быть в наличии на руках еще до покупки процессора и платы — накопители с PCIe 4.0 сами по себе только появились, да и стоят дорого. В общем, могут быть приобретены для новой системы, но если уж решено сэкономить на плате... то на SSD — и подавно :) Так что разница между платформами (или ее отсутствие) в его случае с практической точки зрения даже интереснее.

Поскольку сегодняшнее тестирование достаточно специфично, мы не стали заносить результаты тестов в общую таблицу: они доступны в отдельном файле в формате Microsoft Excel. Так что желающие покопаться в цифрах (тем более, что не все они попадают на диаграммы) могут скачать его и удовлетворить любопытство.
Производительность в приложениях

На провокационный вопрос, а нужна ли вообще вся эта возня с интерфейсами и прочим — вплоть до выбора SSD для использования его в качестве «системного накопителя», мы отвечать не будем. Потому, что неоднократно отвечали — с этой точки зрения не нужна. Даже самый простой SATA-накопитель обеспечивает потребности массового ПО с существенным запасом, более быстрые — этот самый запас только увеличивают, а высокоуровневые бенчмарки работают «как есть», честно эмулируя и все задержки программ, так что распорядиться им не могут.

Вот если задержки убрать... Да тоже ничего интересного. За исключением несколько нетривиальных зависимостей: например, оба накопителя быстрее всего работают в паре с 3700Х, но на плате на Х470! Для WD Black такое можно объяснить, поскольку он все равно поддерживает только PCIe 3.0, но вот почему не «выстрелил» более быстрый интерфейс у Aorus? И на разницу в платах не спишешь, поскольку самой медленной является связка из 2700Х и все того же Х470. Опять же — напомним, что при установке этого процессора на Х570, процессорный слот работает в режиме х2, т. е. опять имеем двукратную разницу в пропускной способности интерфейсов, но что-то из сторонних факторов оказывается более весомым. Характерно, что SSD при этом выбирать таки смысл имеет — Aorus в любом случае быстрее WD в равных условиях. Да и в неравных в основном тоже.

Предыдущая версия пакета оперирует более «легкими» нагрузками, так что и более восприимчива к той же пропускной способности интерфейса (что мы неоднократно отмечали). Но в целом мы рекомендуем обращать внимание в первую очередь на накопитель, а потом уже на способ его подключения. Разумеется, в тех случаях, когда выбор есть, стоит выбирать более быстрый вариант. А если нет, то не менять же из-за этого платформу, да и просто плату :)
Последовательные операции

В многопоточном режиме это задача на интерфейс — вот его и протестировали :) При прочих равных, естественно, самым медленным будет PCIe 3.0 x2, вдвое быстрее — PCIe 3.0 x4, а PCIe 4.0 позволяет получить еще больше — если сам накопитель это поддерживает. Однопоточная производительность пусть и ниже потенциального максимума, но тоже пропорциональна скорости интерфейса. В целом все так, как и должно быть. Кроме, конечно, режима х2 со старым процессором на новой плате, но это может оказаться и единичным «глюком». К тому же, и не критичным — остаются чипсетные слоты, которые в такой конфигурации ведут себя нормально.
Случайный доступ

Наступает полная ясность с причиной «провала» АМ4 в прошлом тестировании: сам по себе Ryzen 7 2700X плохо справляется с генерацией рабочих нагрузок — особенно это заметно на коротких очередях. И наиболее рельефно проявляется при записи. 3700Х ведет себя куда лучше — независимо от способа подключения. Да и вообще эти сценарии не слишком восприимчивы к интерфейсу и его пропускной способности. Зато сильно зависят от конкретного накопителя и процессора — который должен «заставить» выложиться накопитель по полной программе. Ноутбучным процессорам, равно как и Ryzen первого/второго поколения, на такие подвиги не хватает собственных сил. Настольным Core и новым Ryzen — достаточно. Повторимся: практически независимо от интерфейса (в разумных пределах, конечно).
Работа с большими файлами

По сути, мы возвращаемся к «задачам на интерфейс», так что просто посмотрим на все сценарии без дополнительных комментариев.

Впрочем, один комментарий будет — несложно заметить, что, при использовании высокоскоростных накопителей, мощный процессор ныне уже требуется и для того, чтобы просто «ворочать» большими объемами данных. Причем в первую очередь необходима однопоточная производительность. Поэтому старые Ryzen… ну вы поняли :)
Рейтинги

Однозначно плохо все, что связано с Ryzen 7 2700X — сниженная производительность на мелкоблоке. Плюс он же в новой плате заставил накопители работать в режиме PCIe 3.0 x2 — что для части нагрузок тоже критично. Ну а поддержка PCIe 4.0 что-то дать могла только одному накопителю в двух конфигурациях, т. е. 1/6 от общего объема работ. Так что внутренние улучшения Ryzen «3000», а также (при использовании плат на новом чипсете) полная поддержка хотя бы PCIe 3.0 всеми слотами на данный момент более весомы. Но если «всеми слотами» не требуется, а нужен просто один быстро работающий SSD — на плате можно и сэкономить. Заодно и сэкономив на накопителе — по понятным причинам еще долгое время модели с поддержкой PCIe 4.0 будут стоить дороже. А в «экономичном наборе» она, как раз, и не нужна.

Подмешивание результатов тестов высокого уровня картину лишь немного сглаживает, но не меняет. Главное не меняется: и при использовании массовых SSD с интерфейсом PCIe 3.0 новые процессоры лучше старых. Даже при работе на старых платах — проблемы могут возникнуть только при желании использования нескольких накопителей, т. е. достаточно редко. Новый же чипсет их решает полностью — да еще и поддержку PCIe 4.0 добавляет, которой реально можно воспользоваться на практике. Но платить за это придется больше, конечно. А вот процессоры старых линеек становятся интересными только при существенных скидках. Да и в этом случае придется хорошенько подумать, прежде чем приобрести, например, Ryzen 7 2700X по цене какого-нибудь Ryzen 5 3600 ;)
Итого

Главным итогом, пожалуй, является «реабилитация» платформы АМ4, раскритикованной нами в прошлый раз — на деле все отмеченные проблемы связаны с особенностями «старых» процессоров Ryzen и были исправлены в новых. Понятно, что проблемы с «выжиманием» максимальных скоростей относятся больше к потенциальным, поскольку на практике столько не требуется, но «осадочек» ранее оставался — а теперь он рассосался. При этом речь не идет только лишь о поддержке PCIe 4.0 — улучшена и работа с массовыми накопителями, ограничивающимися PCIe 3.0 x2/x4. И для этого даже не требуется дорогая системная плата на базе чипсета Х570 — если запросы не выходят за рамки одного накопителя (что выполняется в подавляющем большинстве случаев), можно сэкономить. Или не экономить — получив в качестве бонуса быструю работу с несколькими SSD, в т. ч. и поддерживающими новую версию PCIe. Тут уж дело вкуса. Главное, подчеркнем, в любом случае стоит выбирать Ryzen семейства 3000 — они хороши не только как процессоры, но и для быстрой работы с твердотельными накопителями.
