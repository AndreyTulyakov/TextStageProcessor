Продолжение исследования быстродействия файловых систем при помощи Intel NASPT
USB 3.0 и быстрый флэш-накопитель
Sorry, temp error.

В прошлый раз мы с вами изучали вопрос, как на основных для семейства Windows (другие ОС вследствие мизерной распространенности можно в расчет и не принимать) файловых систем сказывается прогресс в области внешних устройств хранения данных. Выяснили, что не так уж сильно и сказался — разумеется, в части сценариев переход на USB 3.0 позволяет заметно увеличить производительность, что, тем более, «подстегивается» и увеличением скорости самих по себе внешних винчестеров, но происходит это далеко не всегда и везде. Хотя и некоторые интересные тенденции тоже были отмечены.
А что произойдет при радикальном изменении «рабочего тела», т.?е. переходе от механики к флэш-памяти? Последний раз мы такую ситуацию рассматривали еще во времена господства USB 2.0, но уже тогда пришли к выводу, что «стандартные» флэшдрайвы не слишком интересны, ввиду низкой собственной производительности. Забегая вперед (это уже тема совсем других статей) скажем, что массовым флэшкам и переход на USB 3.0 почти ничего не дал. За исключением увеличения скорости чтения, разумеется, но к ней особых претензий уже давно не осталось. А вот запись... Запись на многих недорогих моделях выполняется медленнее, чем на «хороших» флэшдрайвах с USB 2.0.
Однако еще четыре года назад мы опробовали и SSD при USB-подключении — и вот результаты их-то и оказались крайне интересными. Впрочем, в те времена такое использование твердотельных накопителей было слишком уж экзотическим — из-за высоких цен самой флэш-памяти, да и многоканальных контроллеров тоже. Применять сейчас какой-нибудь топовый SSD в качестве внешнего накопителя — тоже то еще излишество, однако кое-что изменилось на самом рынке. Борьба за высокую производительность в топовом сегменте и общее снижение цен привели к тому, что некоторые былые представители массового сегмента твердотельных накопителей оказались не у дел в плане применения именно в SSD. Зато на них можно сделать быстрый внешний накопитель — куда более быстрый, чем флэшки на «обычных» контроллерах. Причем, заметим, некоторые такие накопители уже помещаются и в стандартные корпуса, хотя не такими уж редкими гостями на полках магазинов оказываются и так называемые «внешние SSD».

Такое устройство мы для тестирования и взяли — Verbatim USB 3.0 External SSD. Уже не слишком новое, потому имеющее небольшую емкость в 32 ГБ. Но при неплохих скоростных показателях — 150 МБ/с при чтении и 60 МБ/с при записи данных. Что касается исполнения, то оно ближе к внешним винчестерам — это имеет и недостатки, и достоинства. К первым относится использование для подключения кабеля, что менее удобно, чем воткнуть устройство прямо в порт. С другой стороны, зато оно никому там мешать из соседей не будет, да и под рукой болтаться тоже, что уже плюс. Ну а для сравнения будет использоваться тот же внешний винчестер PQI H567V, подключенный к USB 3.0 — как нам кажется, низкоскоростной вариант шины USB уже малоинтересен. Особенно для тех, кто приобретает External SSD — не для того же, чтобы мириться с ограничениями USB 2.0.
Для тестирования, как и ранее, применялся тот же стенд, на котором до последнего времени мы тестировали ВЖД и внешние модули:
EpoX 8NPA SLI
AMD Athlon 64 3200+ (512K L2)
1 ГБ РС3200 DDR SDRAM
системный винчестер Western Digital WD1600JS
контроллер USB 3.0 ASUS U3S6
Windows XP Pro + SP3
Сейчас уже мы обновили тестовую методику, однако в процессе первых тестов уже выяснили, что ни радикальная смена оборудования, ни переход на Windows 7 на практике результаты используемых нами сценариев NASPT изменяют не слишком сильно. Что логично — они больше зависят от самих накопителей. А смена условий чуть-чуть сдвигает конкретные цифры, но для всех и одинаковым образом.

Итак, начнем с потокового чтения. Оба накопителя выкладываются на полную, у флэшки эта «полная» вдвое выше, но файловые системы особого значения не имеют, так что относительная разница между ними еще более уменьшается.

Переход к двум потокам высвечивает кардинальную разницу между механикой (не всей — многие современные винчестеры теряют в многопоточном режиме куда меньше) и полупроводниковой памятью, но не слишком меняет расстановку сил среди файловых систем. Разве что NTFS начинает выходить на первое место, поскольку во многом под многозадачность и оптимизирована изначально, однако преимущество слишком уж невелико. Еще отметим, что в прошлый раз для винчестера мы получили в режиме USB 3.0 более низкую скорость, чем при его подключении посредством USB 2.0 — сказались уже накладные расходы на обеспечение работы более быстрого интерфейса. Для флэш-накопителя они тоже есть, однако абсолютные скорости явно показывают, что USB 2.0 тут было бы недостаточно никоим образом.

На четырех потоках чтения ситуация лишь немногим усугубляется, но без принципиальных изменений.

При потоковой записи при выбранном авторами NASPT алгоритме на деле приходится и дописывать данные в файл, и модифицировать служебную информацию. За счет этого exFAT и выигрывала — большие блоки (а для данного винчестера — по-умолчанию огромные) снижали потери на выполнение второй операции. Для флэш-памяти же доступ к разным областям «диска» менее болезнен, так что тут уже большой разницы между ФС нет.

А при записи одновременно с чтением уменьшается и разница между накопителями — винчестер быстрее пишет данные, но у флэш-накопителя это компенсируется меньшими потерями при одновременном доступе к нескольким файлам. Особенно невелика разница при использовании NTFS, относительно велика — при применении более простых систем, но в целом видно, что при таком использовании (вполне вероятном на практике) «классические» внешние накопители на базе винчестеров все еще выглядят более чем актуальными решениями, несмотря на экспансию флэша и в эту область.

При непосредственной работе с большим количеством файлов небольшого размера тоже. Но более интересно нам в этом случае другое — exFAT была самой быстрой на винчестере и стала самой медленной на флэшке. Почему? Возможно, во многом из-за того, что емкость очень уже разная. То есть для флэшдрайвов или карт памяти до 32 ГБ вполне подходит старая добрая FAT32, единственным недостатком которой является отсутствие поддержки файлов большого размера. А вот на более емких устройствах более предпочтительной может оказаться exFAT.

Для внешнего накопителя несколько оторванный от жизни сценарий, в котором традиционно проигрывает всем exFAT — в очередной раз и независимо от интерфейсов или типа носителей. Ну и разница между внешним SSD и типовым ВЖД в очередной раз уже невелика.

А в шаблоне фотоальбома она вообще исчезает при использовании exFAT и почти исчезает в остальных случаях, т.?е. это очередной пример существования в природе нагрузок такого типа, при котором разницы между механическими и полупроводниковыми носителями не будет — все определяется совсем другими факторами.


Как и следовало ожидать, мы получили ровно ту же картину, что и в шаблонах воспроизведения и записи видео — на деле в NASPT они отличаются лишь размерами блоков данных, что не так уж и важно. Да и не повторяет в точности «настоящие» операции копирования файлов.

Интереснее дела обстоят если нам нужно скопировать большое количество маленьких файлов — в шаблоне используется 2833 файла, суммарным объемом 1,2 ГБ. На винчестере при использовании exFAT он из-за размера кластера вообще разрастался до 3 ГБ, что приводило к огромному проигрышу этой ФС конкурентам. У флэш-накопителя накладные расходы намного меньше, однако проигрыш никуда не делся, но заметно уменьшился. А FAT32 и NTFS поменялись местами, что, впрочем, обычно для большинства ранее протестированных накопителей, за исключением PQI H567V при подключении к USB 3.0, т.?е. как раз последнее было отклонением от нормы, а не наоборот.

С чем NTFS зато всегда справлялась лучше всех, так это с копированием большого количества файла небольшого размера в обратном направлении — на накопитель. Причем при смене носителя все значения выросли в одинаковой степени.
В общем и целом же можно повторить выводы предыдущей статьи: освоение новых интерфейсов и новых носителей данных не слишком сказалось на сравнительном быстродействии различных файловых систем — как и ранее, на первом месте остаются сферы применения устройств. В таком разрезе NTFS и exFAT на данный момент хорошо дополняют друг друга: первая хорошо подходит для «тяжелой» работы, вторая же экономична в плане потребляемых ресурсов системы и отлично справляется с современными мультимедийными данными, где речь обычно идет о файлах большого размера. На внешних накопителях можно использовать и ту, и другую — в зависимости от того, совместно с чем предполагается применять сами накопители. В ряде случаев, впрочем, производители особой свободы не представляют — для карт SDXC, к примеру, стандартом по-умолчанию является exFAT. Впрочем, как раз отлично для них подходящая, так что при наличии поддержки со стороны устройства ее можно использовать и на SDHC — взамен архаичной FAT32 со всеми ее недостатками. На внешних винчестерах, как мы видели в прошлый раз, эта система тоже нередко будет к месту. Если, конечно, не хранить на них тысячи и сотни тысяч мелких файлов, где заметными окажутся потери дискового пространства и прочие особенности. А вот для хранения фильмов — в самый раз. Но, опять же — определившись с тем, какие устройства должны иметь доступ к накопителю. К примеру, exFAT отлично подходит для тех, кто использует и MacOS и Windows, поскольку это единственная пристойная (не считать же уже таковой FAT32) ФС, полная поддержка которой встроена в обе системы. Однако понятно, что при таких исходных данных вопросы сравнительного быстродействия уже не важны. Как, впрочем, и в большинстве прочих случаев — просто назначение систем разное, откуда проистекают и все остальные различия.